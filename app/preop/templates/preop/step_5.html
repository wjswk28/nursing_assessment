{% extends "preop/step_base.html" %}
{% set hide_nav = True %}
{% set title = "ì „ì‹  ë° ê¸°ëŠ¥ ìƒíƒœ í‰ê°€" %}

{% block form_fields %}

<div class="space-y-4">

    <!-- 1. ì „ì‹  ìƒíƒœ -->
    <div>
        <label class="font-semibold text-sky-700">1. ì „ì‹  ìƒíƒœ</label>
        <div class="flex items-center gap-6 mt-3">
            <label>
                <input type="checkbox" name="general_good" value="1"
                       {% if saved.general_good == "1" %} checked {% endif %}>
                ì–‘í˜¸
            </label>
            <label>
                <input type="checkbox" name="general_poor" value="1"
                       {% if saved.general_poor == "1" %} checked {% endif %}>
                í—ˆì•½í•¨
            </label>
        </div>
    </div>

    <!-- 2. ì •ì„œì  ìƒíƒœ -->
    <div class="disease-group" data-field="emotion">
        <label class="font-semibold text-sky-700">2. ì •ì„œì  ìƒíƒœ</label>

        <div class="flex items-center gap-6 mt-3">
            <label>
                <input type="radio" name="emotion" value="ì–‘í˜¸"
                       class="radio-none"
                       {% if saved.emotion == "ì–‘í˜¸" %} checked {% endif %}> ì–‘í˜¸
            </label>

            <label>
                <input type="radio" name="emotion" value="ë¶ˆì•ˆ"
                       class="radio-none"
                       {% if saved.emotion == "ë¶ˆì•ˆ" %} checked {% endif %}> ë¶ˆì•ˆ
            </label>

            <label>
                <input type="radio" name="emotion" value="ê¸°íƒ€"
                       class="radio-yes"
                       {% if saved.emotion == "ê¸°íƒ€" %} checked {% endif %}> ê¸°íƒ€
            </label>
        </div>

        <input name="emotion_desc"
               value="{{ saved.emotion_desc or '' }}"
               class="w-full border rounded-lg px-3 py-2 mt-3 desc-box
                      {% if saved.emotion != 'ê¸°íƒ€' %} hidden {% endif %}"
               placeholder="ê¸°íƒ€ ì •ì„œ ìƒíƒœë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.">
    </div>

    <!-- 3. ì„­ì·¨ ìƒíƒœ -->
    <div>
        <label class="font-semibold text-sky-700">3. ì„­ì·¨ ìƒíƒœ</label>
        <div class="flex items-center gap-6 mt-3">
            <label>
                <input type="checkbox" name="eating_normal" value="1"
                       {% if saved.eating_normal == "1" %} checked {% endif %}> ì •ìƒ
            </label>

            <label>
                <input type="checkbox" name="eating_dysphagia" value="1"
                       {% if saved.eating_dysphagia == "1" %} checked {% endif %}> ì—°í•˜ê³¤ë€
            </label>
        </div>
    </div>

    <!-- 4. ìµœê·¼ 3ê°œì›” ì²´ì¤‘ ê°ì†Œ -->
    <div class="disease-group" data-field="wtloss">
        <label class="font-semibold text-sky-700">4. ìµœê·¼ 3ê°œì›” ì²´ì¤‘ ê°ì†Œ</label>

        <div class="flex items-center gap-6 mt-3">
            <label>
                <input type="radio" name="wtloss" value="ë¬´"
                       class="radio-none"
                       {% if saved.wtloss == "ë¬´" %} checked {% endif %}> ë¬´
            </label>

            <label>
                <input type="radio" name="wtloss" value="ìœ "
                       class="radio-yes"
                       {% if saved.wtloss == "ìœ " %} checked {% endif %}> ìœ 
            </label>
        </div>
    </div>

    <!-- 5. ì¹˜ë£Œì‹ ì—¬ë¶€ -->
    <div class="disease-group" data-field="therapeutic_diet">
        <label class="font-semibold text-sky-700">5. ì¹˜ë£Œì‹ ì—¬ë¶€</label>

        <div class="flex items-center gap-6 mt-3">
            <label>
                <input type="radio" name="therapeutic_diet" value="ë¬´"
                       class="radio-none"
                       {% if saved.therapeutic_diet == "ë¬´" %} checked {% endif %}> ë¬´
            </label>

            <label>
                <input type="radio" name="therapeutic_diet" value="ìœ "
                       class="radio-yes"
                       {% if saved.therapeutic_diet == "ìœ " %} checked {% endif %}> ìœ 
            </label>
        </div>

        <input name="therapeutic_diet_desc"
               value="{{ saved.therapeutic_diet_desc or '' }}"
               class="w-full border rounded-lg px-3 py-2 mt-3 desc-box
                      {% if saved.therapeutic_diet != 'ìœ ' %} hidden {% endif %}"
               placeholder="ì–´ë–¤ ì¹˜ë£Œì‹ì¸ì§€ ì…ë ¥í•˜ì„¸ìš”.">
    </div>

    <!-- 6. ì‹œë ¥ì¥ì•  -->
    <div class="disease-group" data-field="vision">
        <label class="font-semibold text-sky-700">6. ì‹œë ¥ì¥ì• </label>

        <div class="flex items-center gap-6 mt-3">
            <label>
                <input type="radio" name="vision" value="ë¬´"
                       class="radio-none"
                       {% if saved.vision == "ë¬´" %} checked {% endif %}> ë¬´
            </label>

            <label>
                <input type="radio" name="vision" value="ìœ "
                       class="radio-yes"
                       {% if saved.vision == "ìœ " %} checked {% endif %}> ìœ 
            </label>
        </div>

        <div class="flex gap-6 mt-3 desc-box {% if saved.vision != 'ìœ ' %} hidden {% endif %}">
            <label><input type="checkbox" name="vision_glasses" value="1"
                {% if saved.vision_glasses == "1" %} checked {% endif %}> ì•ˆê²½</label>

            <label><input type="checkbox" name="vision_lens" value="1"
                {% if saved.vision_lens == "1" %} checked {% endif %}> ë Œì¦ˆ</label>
        </div>
    </div>

    <!-- 7. ì²­ë ¥ì¥ì•  -->
    <div class="disease-group" data-field="hearing">
        <label class="font-semibold text-sky-700">7. ì²­ë ¥ì¥ì• </label>

        <!-- ìœ /ë¬´ -->
        <div class="flex items-center gap-6 mt-2">
            <label>
                <input type="radio" name="hearing" value="ë¬´"
                    class="radio-none"
                    {% if saved.hearing == "ë¬´" %}checked{% endif %}>
                ë¬´
            </label>

            <label>
                <input type="radio" name="hearing" value="ìœ "
                    class="radio-yes"
                    {% if saved.hearing == "ìœ " %}checked{% endif %}>
                ìœ 
            </label>
        </div>

        <!-- ìœ  ì„ íƒ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” ì „ì²´ ë°•ìŠ¤ -->
        <div class="mt-3 space-y-3 desc-box {% if saved.hearing != 'ìœ ' %} hidden {% endif %}"
            id="hearing-detail-box">

            <!-- ì²« ë²ˆì§¸ ì¤„: ë³´ì²­ê¸° + ì˜¤ë¥¸ìª½/ì™¼ìª½ (ë³´ì²­ê¸° ì²´í¬ ì‹œ í‘œì‹œ) -->
            <div class="flex flex-wrap items-center gap-4">
                <label class="flex items-center gap-1">
                    <input type="checkbox" id="hearing_aid" name="hearing_aid" value="1"
                        {% if saved.hearing_aid == "1" %}checked{% endif %}>
                    ë³´ì²­ê¸°
                </label>

                <!-- ë³´ì²­ê¸° ì²´í¬ ì‹œ í‘œì‹œí•  ì˜¤ë¥¸ìª½/ì™¼ìª½ -->
                <div id="aid-side-box"
                    class="flex items-center gap-4 {% if saved.hearing_aid != '1' %}hidden{% endif %}">
                    <label><input type="checkbox" name="hearing_right" value="1"
                        {% if saved.hearing_right == "1" %}checked{% endif %}> ì˜¤ë¥¸ìª½</label>

                    <label><input type="checkbox" name="hearing_left" value="1"
                        {% if saved.hearing_left == "1" %}checked{% endif %}> ì™¼ìª½</label>
                </div>
            </div>

            <!-- ë‘ ë²ˆì§¸ ì¤„: ê¸°íƒ€ ì…ë ¥ì¹¸ -->
            <div>
                <label class="text-slate-600 text-sm">ê¸°íƒ€:</label>
                <input type="text"
                    name="hearing_desc"
                    class="w-full border rounded-lg px-3 py-2 mt-1"
                    placeholder="ì²­ë ¥ê´€ë ¨ ì§ˆí™˜ ì…ë ¥"
                    value="{{ saved.hearing_desc or '' }}">
            </div>

        </div>
    </div>



    <!-- 8. ìˆ˜ë©´ì¥ì•  -->
    <div class="disease-group" data-field="sleep">
        <label class="font-semibold text-sky-700">8. ìˆ˜ë©´ì¥ì• </label>

        <div class="flex items-center gap-6 mt-3">
            <label><input type="radio" name="sleep" value="ë¬´" class="radio-none"
                {% if saved.sleep == "ë¬´" %} checked {% endif %}> ë¬´</label>

            <label><input type="radio" name="sleep" value="ìœ " class="radio-yes"
                {% if saved.sleep == "ìœ " %} checked {% endif %}> ìœ </label>
        </div>

        <input name="sleep_desc"
               value="{{ saved.sleep_desc or '' }}"
               class="w-full border rounded-lg px-3 py-2 mt-3 desc-box
                      {% if saved.sleep != 'ìœ ' %} hidden {% endif %}"
               placeholder="ìˆ˜ë©´ì¥ì•  ë‚´ìš© ì…ë ¥">
    </div>

    <!-- 9. ë°°ë³€ì¥ì•  -->
    <div class="disease-group" data-field="bowel">
        <label class="font-semibold text-sky-700">9. ë°°ë³€ì¥ì• </label>

        <div class="flex items-center gap-6 mt-3">
            <label><input type="radio" name="bowel" value="ë¬´" class="radio-none"
                {% if saved.bowel == "ë¬´" %} checked {% endif %}> ë¬´</label>

            <label><input type="radio" name="bowel" value="ìœ " class="radio-yes"
                {% if saved.bowel == "ìœ " %} checked {% endif %}> ìœ </label>
        </div>

        <input name="bowel_desc"
               value="{{ saved.bowel_desc or '' }}"
               class="w-full border rounded-lg px-3 py-2 mt-3 desc-box
                      {% if saved.bowel != 'ìœ ' %} hidden {% endif %}"
               placeholder="ë°°ë³€ì¥ì•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.">
    </div>

    <!-- 10. ë°°ë‡¨ì¥ì•  -->
    <div class="disease-group" data-field="urination">
        <label class="font-semibold text-sky-700">10. ë°°ë‡¨ì¥ì• </label>

        <div class="flex items-center gap-6 mt-3">
            <label><input type="radio" name="urination" value="ë¬´" class="radio-none"
                {% if saved.urination == "ë¬´" %} checked {% endif %}> ë¬´</label>

            <label><input type="radio" name="urination" value="ìœ " class="radio-yes"
                {% if saved.urination == "ìœ " %} checked {% endif %}> ìœ </label>
        </div>

        <input name="urination_desc"
               value="{{ saved.urination_desc or '' }}"
               class="w-full border rounded-lg px-3 py-2 mt-3 desc-box
                      {% if saved.urination != 'ìœ ' %} hidden {% endif %}"
               placeholder="ë°°ë‡¨ì¥ì•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.">
    </div>

</div>

<!-- ìœ /ë¬´ ì„ íƒ ì‹œ ì„¸ë¶€í•­ëª© í‘œì‹œ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
document.addEventListener("DOMContentLoaded", () => {

    /* ê¸°ì¡´ ìœ /ë¬´ desc ë°•ìŠ¤ ì œì–´ */
    document.querySelectorAll(".disease-group").forEach(group => {
        const yes = group.querySelector(".radio-yes");
        const no = group.querySelector(".radio-none");
        const boxes = group.querySelectorAll(".desc-box");

        yes && yes.addEventListener("change", () => {
            boxes.forEach(b => b.classList.remove("hidden"));
        });

        no && no.addEventListener("change", () => {
            boxes.forEach(b => b.classList.add("hidden"));
        });
    });

    /* ğŸ”¥ ì²­ë ¥ì¥ì•  â€” ë³´ì²­ê¸° í´ë¦­ ì‹œ ì˜¤ë¥¸ìª½/ì™¼ìª½ í‘œì‹œ */

    const hearingAid = document.getElementById("hearing_aid");
    const sideBox = document.getElementById("aid-side-box");

    if (hearingAid) {
        hearingAid.addEventListener("change", () => {
            if (hearingAid.checked) {
                sideBox.classList.remove("hidden");
            } else {
                sideBox.classList.add("hidden");

                // ë³´ì²­ê¸° í•´ì œ ì‹œ ì˜¤ë¥¸ìª½/ì™¼ìª½ë„ ìë™ í•´ì œ
                document.querySelector("input[name='hearing_right']").checked = false;
                document.querySelector("input[name='hearing_left']").checked = false;
            }
        });
    }
});
</script>


{% endblock %}
